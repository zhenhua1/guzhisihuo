var pickout=(function(){"use strict";var ownConfig={};var defaults={theme:'clean',search:false};function init(config){setElement(config);prepareElement();}
function setElement(config){var objConfig=typeof config==='object'?config:{};if(typeof config==='string'){objConfig.el=config;}
objConfig.DOM=[].slice.call(document.querySelectorAll(objConfig.el));mergeToDefaults(objConfig);}
function prepareElement(){ownConfig.DOM.map(function(select,index){createElements(select,index);});prepareModal();}
function createElements(select,index){var config=ownConfig;select.style.display='none';var parent=select.parentElement;parent.setAttribute('style','position:relative;float:left;');var placeholder=select.getAttribute('placeholder');var input=document.createElement('input');input.setAttribute('readonly','readonly');input.setAttribute('class','pk-input -'+config.theme);if(!!placeholder)input.setAttribute('placeholder',placeholder);if(parent.hasAttribute('for'))input.setAttribute('id',parent.getAttribute('for'));var arrow=document.createElement('span');arrow.setAttribute('class','pk-arrow -'+config.theme);parent.appendChild(input);parent.appendChild(arrow);parent.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();config.currentIndex=index;fireModal(config);},false);}
function fireModal(config){var modal=document.querySelector('.pk-modal'),select=config.DOM[config.currentIndex],data;modal.setAttribute('class',modal.getAttribute('class')+' -'+config.theme);var main=modal.querySelector('.main');if(!!main.children.length){return;}
var overlay=document.querySelector('.pk-overlay');var options=[].slice.call(select);var optionsModal=options.map(function(option,key){data={index:key,item:option};return createOption(data,modal,config);});modal.setAttribute('class',modal.getAttribute('class')+' -show');overlay.setAttribute('class',overlay.getAttribute('class')+' -show');var title=select.hasAttribute('placeholder')?select.getAttribute('placeholder'):'Select to option';modal.querySelector('.head').innerHTML=title;if(config.search){var search=modal.querySelector('.pk-search');var inputSearch=search.querySelector('input');inputSearch.value='';setTimeout(function(){inputSearch.focus();},300);search.setAttribute('class',search.getAttribute('class')+' -show');inputSearch.addEventListener('keyup',function(e){e.preventDefault();e.stopPropagation();var optionsDefault=optionsModal,main=modal.querySelector('.main');if(!!document.documentMode){optionsModal.map(function(option){option.style.display='none';});}else{main.innerHTML='';}
if(!e.target.value){optionsDefault.map(function(option){if(!!document.documentMode){option.style.display='block';return;}
main.appendChild(option);});return;}
optionsModal.map(function(option){var txt=option.children[1]||option.children[0];if(txt.innerHTML.toLowerCase().indexOf(e.target.value.toLowerCase())!==-1){if(!!document.documentMode){option.style.display='block';return;}
main.appendChild(option);}});if(!main.children.length){var noResults=document.createElement('li');noResults.setAttribute('class','pk-no_result_search');noResults.innerHTML='No Results';main.appendChild(noResults);return;}},false);}}
function createOption(data,modal,config){var select=config.DOM[config.currentIndex];var main=modal.querySelector('.main');var item=document.createElement('li');var selected=data.item.hasAttribute('selected')?'-selected':'';item.setAttribute('class','pk-option '+selected+' -'+config.theme);var icon=document.createElement('span');icon.setAttribute('class','icon');icon.innerHTML=data.item.getAttribute('data-icon')||'';var txt=document.createElement('span');txt.setAttribute('class','txt');txt.innerHTML=data.item.innerHTML;main.appendChild(item);item.appendChild(icon);item.appendChild(txt);item.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();[].slice.call(select.children).map(function(item,index){if(index===data.index){item.setAttribute('selected','selected');return;}
item.removeAttribute('selected');});feedInput(select,txt.innerHTML);closeModal();},false);return item;}
function feedInput(select,value){select.parentElement.querySelector('.pk-input').value=value;}
function setInitialValue(config){setElement(config);ownConfig.DOM.map(function(select){feedInput(select,select[select.selectedIndex].innerHTML);});}
function prepareModal(){if(document.querySelector('.pk-overlay')){return;}
var overlay=document.createElement('div');overlay.setAttribute('class','pk-overlay');var modal=document.createElement('div');modal.setAttribute('class','pk-modal');var mainModal=document.createElement('ul');mainModal.setAttribute('class','main');var head=document.createElement('div');head.setAttribute('class','head');var search=document.createElement('div');search.setAttribute('class','pk-search');var inputSearch=document.createElement('input');inputSearch.setAttribute('type','text');var close=document.createElement('span');close.setAttribute('class','close');close.innerHTML='&times;';document.body.appendChild(overlay);document.body.appendChild(modal);modal.appendChild(head);modal.appendChild(search);search.appendChild(inputSearch);modal.appendChild(close);modal.appendChild(mainModal);overlay.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();closeModal();},false);close.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();closeModal();},false);}
function closeModal(){var overlay=document.querySelector('.pk-overlay');var modal=document.querySelector('.pk-modal');var search=modal.querySelector('.pk-search');overlay.setAttribute('class','pk-overlay');modal.setAttribute('class','pk-modal');search.setAttribute('class','pk-search');setTimeout(function(){modal.querySelector('.main').innerHTML='';},500);}
function mergeToDefaults(config){ownConfig=JSON.parse(JSON.stringify(defaults));for(var item in config){if(config.hasOwnProperty(item)){ownConfig[item]=config[item];}}}
return{to:init,updated:setInitialValue};})();if(typeof module!=='undefined'&&module.exports){module.exports=pickout;}